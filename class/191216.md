# 19년 12월 16일

## Linux 명령어
+ ifconfig - ip확인 명령어
+ pwd - 현재 디렉토리 경로 확인
+ Mysql 설치
  + yum -y install mysql-community-server
  + root 명령어 필요 -> sudo
  + sudo yum -y install http://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm
  + sudo yum -y install mysql-community-server
  + ip address show - ip 확인

## Mysql 실행
+ sudo systemctl enable mysqld
+ sudo systemctl start mysqld
+ sudo cat /var/log/mysqld.log - log파일에서 password 확인 -> 로그인
+ mysql -uroot -p
    ### 패스워드 변경
+ SET GLOBAL validate_password_policy=LOW; - 패스워드 정책 변경
+ alter user 'root'@'localhost' identified by 'test1234';
+ show variables like 'validate_password%'; - 정책 확인

## Mysql 사용 - 레플리케이션
---
node1을 master DB로 하여 node2, windows를 Slave DB로 사용.

Master DB(node1)
+ ip : 192.168.56.11(3306)
+ DB : cloud_db
+ User : user1/test1234
+ user : recplicate use/test1234 (node2, windows를 slave DB로 사용)
                                  
Slave DB(node2) 
+ ip : 192.168.56.12(3306)
+ DB : cloud db
+ user : user2/teset1234

SlaveDB(Windows)
+ ip : Windows ip(3306)
+ db : cloud_db
+ user : user1/test1234

1. Vagrantfild 수정
+ node2 설치
  + 포트 및 ip 참조(cmd 에서 ipconfig 이더넷 어댑터 ipv4 주소로 설정)

+ ping ip주소 - 속도 측정
+ mysql -uroot -p -h192.168.56.11 - node02 에서 node01 데이터베이스 접속
  + -h 옵션

### 시작
+ create database cloud_db default character set utf8;
  + 데이터베이스 생성
+ use cloud_db
+ create user 'user1'@'%' identified by 'test1234';
  + %는 user1에 모든 ip들이 사용할 수있다.
+ grant all privileges on cloud_db.* to 'user1'@'%' identified by 'test1234';
  + user1에 cloud_db에 모든 권핝귀, 모든 ip에서 접근 가능함.
+ 



``` vagrantfile
# Vagrantfile
Vagrant.configure("2") do |config|
  # Ansible-Node01
  config.vm.define:"node01" do |cfg|
    cfg.vm.box = "centos/7"
    cfg.vm.provider:virtualbox do |vb|
        vb.name="Node01"
        vb.customize ["modifyvm", :id, "--cpus", 1]
        vb.customize ["modifyvm", :id, "--memory", 1024]
    end
    cfg.vm.host_name="node01"
    cfg.vm.network "public_network", ip: "192.168.56.11"
    cfg.vm.network "forwarded_port", guest: 22, host: 19211, auto_correct: false, id: "ssh"
    cfg.vm.network "forwarded_port", guest: 80, host: 10080
    cfg.vm.network "forwarded_port", guest: 3306, host: 13306
  end

  config.vm.define:"node02" do |cfg|
    cfg.vm.box = "centos/7"
    cfg.vm.provider:virtualbox do |vb|
        vb.name="Node0"
        vb.customize ["modifyvm", :id, "--cpus", 1]
        vb.customize ["modifyvm", :id, "--memory", 1024]
    end
    cfg.vm.host_name="node02"
    cfg.vm.network "public_network", ip: "192.168.56.12"
    cfg.vm.network "forwarded_port", guest: 22, host: 29211, auto_correct: false, id: "ssh"
    cfg.vm.network "forwarded_port", guest: 80, host: 20080
    cfg.vm.network "forwarded_port", guest: 3306, host: 23306
  end
end
```


